### US-002 画像付きツイート自動投稿 フローチャート

```mermaid
graph TD
    A[START: 定刻にシステム起動] --> B;
    B[投稿キュー(スプレッドシート)にアクセス] --> C;
    C{"「未投稿」ステータスで<br>予約日時を過ぎたツイートを検索"} --> D{対象ツイートは存在するか？};
    D -- Yes --> E{"画像リンク(GoogleドライブURL)あり？"};
    D -- No --> I[END: 処理終了];
    
    E -- Yes --> F[Google Drive APIへ画像データを要求];
    F --> G[画像データを取得];
    G --> H[Twitter APIへツイート内容と<br>画像を送信];
    
    E -- No --> H_TEXT_ONLY[Twitter APIへツイート内容のみ送信];
    
    H --> I_RESULT{投稿は成功したか？};
    H_TEXT_ONLY --> I_RESULT;
    
    I_RESULT -- Yes --> J[対象ツイートのステータスを<br>「投稿済」に更新];
    J --> K[「投稿完了日時」を記録];
    K --> I;
    
    I_RESULT -- No --> L[失敗処理へ<br>(US-003で定義)];
    L --> I;

```

### フローチャートの解説

1.  **STARTから対象ツイート検索まで**:

      * この部分はUS-001のフローと同じです。システムが定刻に起動し、スプレッドシートから投稿すべきツイートを検索します。

2.  **画像リンク(GoogleドライブURL)あり？**:

      * 取得したツイートのデータに、Googleドライブの画像リンクが含まれているかを確認します。
      * **Yesの場合 (画像あり)**: 画像取得処理に進みます。
      * **Noの場合 (テキストのみ)**: US-001と同様に、テキストのみを投稿する処理に進みます。

3.  **Google Drive APIで画像データを取得**:

      * スプレッドシートに記載されたURLを元に、Google Drive APIを呼び出します。
      * APIからツイートに添付するための画像データを取得します。この処理は、技術タスク「TASK-003」で実装が定義されています。

4.  **Twitter APIへツイート内容と画像を送信**:

      * 取得したツイートの本文と、Googleドライブから取得した画像データを合わせてTwitter APIへ送信し、投稿を試みます。ユーザーストーリーの定義によると、画像は1〜4件まで対応します。

5.  **投稿結果の判定と記録**:

      * 投稿の成否を判定します。
      * **成功した場合**: スプレッドシートのステータスを「投稿済」に更新し、「投稿完了日時」を記録します。
      * **失敗した場合**: 失敗処理（エラーログ記録など）へ進みます。

6.  **END: 処理終了**:

      * 一連の処理が完了します。